<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.24.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Software Tutorial: Traveling Down an Attractant Gradient - Biological Modeling: A Free Online Course</title>
<meta name="description" content="A free and open online course in biological modeling at multiple scales.">



<meta property="og:type" content="website">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Biological Modeling: A Free Online Course">
<meta property="og:title" content="Software Tutorial: Traveling Down an Attractant Gradient">
<meta property="og:url" content="http://localhost:4000/chemotaxis/tutorial_removal">


  <meta property="og:description" content="A free and open online course in biological modeling at multiple scales.">












<link rel="canonical" href="http://localhost:4000/chemotaxis/tutorial_removal">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": null,
      "url": "http://localhost:4000/"
    
  }
</script>







<!-- end _includes/seo.html -->


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css">



<!--SEO tagging -->
<!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Software Tutorial: Traveling Down an Attractant Gradient | Biological Modeling: A Free Online Course</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="Software Tutorial: Traveling Down an Attractant Gradient" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="A free and open online course in biological modeling at multiple scales." />
<meta property="og:description" content="A free and open online course in biological modeling at multiple scales." />
<link rel="canonical" href="http://localhost:4000/chemotaxis/tutorial_removal" />
<meta property="og:url" content="http://localhost:4000/chemotaxis/tutorial_removal" />
<meta property="og:site_name" content="Biological Modeling: A Free Online Course" />
<meta property="og:image" content="http://localhost:4000/assets/images/chemotaxis_traj_1.0.png" />
<script type="application/ld+json">
{"description":"A free and open online course in biological modeling at multiple scales.","@type":"WebPage","url":"http://localhost:4000/chemotaxis/tutorial_removal","image":"http://localhost:4000/assets/images/chemotaxis_traj_1.0.png","headline":"Software Tutorial: Traveling Down an Attractant Gradient","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-173522486-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-173522486-1');
</script>

    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    <div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <a class="site-title" href="/">Biological Modeling: A Free Online Course</a>
        <ul class="visible-links">
                
                
                    <li class="masthead__menu-item">
                        <a href="/meet-the-team/">Course Team</a>
                    </li>
                
            
                
                
                    <li class="masthead__menu-item">
                        <a href="/contact/">Contact Us</a>
                    </li>
                
            
                
                
                    <li class="masthead__menu-item">
                        <a href="/contents/">Contents</a>
                    </li>
                
            
                
                
                    <li class="dropdown ">
                        <a class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Take the Course    <i class="fa fa-caret-down fa-sm" aria-hidden="true"></i><span class="caret"></span></a>
                        <ul class="dropdown-content">
                            
                                <li>
                                    <a href="/prologue/">    <b>Prologue:</b> an introduction to biological modeling via random walks and Turing patterns</a>
                                </li>
                            
                                <li>
                                    <a href="/motifs/home">    <b>Module 1:</b> Finding motifs in transcription factor networks</a>
                                </li>
                            
                                <li>
                                    <a href="/chemotaxis/home">    <b>Module 2:</b> Unpacking E. coli's genius exploration algorithm</a>
                                </li>
                            
                                <li>
                                    <a href="/coronavirus/home">    <b>Module 3:</b> Analyzing the coronavirus spike protein</a>
                                </li>
                            
                                <li>
                                    <a href="">    <b>Module 4:</b> coming soon!</a>
                                </li>
                            
                        </ul>
                    </li>
                
            
        </ul>
        
        <button class="search__toggle" type="button">
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle Menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">

  <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>

  
  <div class="sidebar sticky">
  
  
    
      
      
      
      
    
    
      

<nav class="nav__list">
  
  <input id="ac-toc" name="accordion-toc" type="checkbox" />
  <label for="ac-toc">Toggle Menu</label>
  <ul class="nav__items">
    
      <li>
        
          <span class="nav__sub-title">Unpacking E. coli's Genius Exploration Algorithm</span>
        

        
        <ul>
          
            <li><a href="/chemotaxis/home">Introduction: The lost immortals<br><br></a></li>
          
            <li><a href="/chemotaxis/home_walk">Bacterial runs and tumbles<br><br></a></li>
          
            <li><a href="/chemotaxis/home_signal">Signaling & ligand-receptor dynamics<br><br></a></li>
          
            <li><a href="/chemotaxis/home_signalpart2">Stochastic simulation of chemical reactions<br><br></a></li>
          
            <li><a href="/chemotaxis/home_biochemistry">A biochemically accurate model of bacterial chemotaxis<br><br></a></li>
          
            <li><a href="/chemotaxis/home_adaptation">Methylation helps a bacterium adapt to differing concentrations<br><br></a></li>
          
            <li><a href="/chemotaxis/home_gradient">Modeling a bacterium's response to an attractant gradient<br><br></a></li>
          
            <li><a href="/chemotaxis/home_conclusion">Conclusion: the beauty of E. coli's robust randomized exploration algorithm<br><br></a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Software Tutorials (featuring BioNetGen)</span>
        

        
        <ul>
          
            <li><a href="/chemotaxis/tutorial_lr">Getting started wtih BioNetGen and modeling ligand-receptor dynamics<br><br></a></li>
          
            <li><a href="/chemotaxis/tutorial_phos">Adding phosphorylation to our BioNetGen model<br><br></a></li>
          
            <li><a href="/chemotaxis/tutorial_adaptation">Modeling bacterial adaptation to changing attractant<br><br></a></li>
          
            <li><a href="/chemotaxis/tutorial_gradient">Traveling up an attractant gradient<br><br></a></li>
          
            <li><a href="/chemotaxis/tutorial_removal" class="active">Traveling down an attractant gradient<br><br></a></li>
          
            <li><a href="/chemotaxis/tutorial_purerandom">Modeling a pure random walk strategy<br><br></a></li>
          
            <li><a href="/chemotaxis/tutorial_walk">Modeling E. coli's sophisticated random walk algorithm<br><br></a></li>
          
            <li><a href="/chemotaxis/tutorial_tumbling_frequencies">Comparing different chemotaxis default tumbling frequencies</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Exercises</span>
        

        
        <ul>
          
            <li><a href="/chemotaxis/home_exercise">Exercises on Chemotaxis<br><br></a></li>
          
        </ul>
        
      </li>
    
  </ul>
</nav>

    
  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Software Tutorial: Traveling Down an Attractant Gradient">
    
    
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Software Tutorial: Traveling Down an Attractant Gradient
</h1>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right sticky">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> On this page</h4></header>
              <ul class="toc__menu"><li><a href="#modeling-a-decreasing-ligand-gradient-with-a-bionetgen-function">Modeling a decreasing ligand gradient with a BioNetGen function</a></li><li><a href="#running-the-bionetgen-model">Running the BioNetGen model</a></li><li><a href="#visualizing-the-results-of-our-simulation">Visualizing the results of our simulation</a></li></ul>

            </nav>
          </aside>
        
        <p>In the <a href="tutorial_gradient">previous tutorial</a>, we simulated the behavior of a bacterium moving up the concentration gradient. In this tutorial, we will simulate the opposite - when the bacterium is not in luck and moves down a concentration gradient.</p>

<p>To get started, create a copy of your <code class="language-plaintext highlighter-rouge">adaptation.bngl</code> file from the <a href="tutorial_adaptation">adaptation tutorial</a> and save it as <code class="language-plaintext highlighter-rouge">removal.bngl</code>. If you would rather not follow along below, you can download a completed BioNetGen file here: <a href="../downloads/downloadable/removal.bngl" download="removal.bngl">removal.bngl</a>.</p>

<p>We also will build a Jupyter notebook in this tutorial for plotting the concentrations of different particles over time. To do so, you should save a copy of your <code class="language-plaintext highlighter-rouge">plotter_up.ipynb</code> file called <code class="language-plaintext highlighter-rouge">plotter_down.ipynb</code>; if you would rather not follow along, we provide a completed notebook here: <a href="../downloads/downloadable/plotter_down.ipynb" download="plotter_down.ipynb">plotter_down.ipynb</a></p>

<p>Before running this notebook, make sure the following dependencies are installed.</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Installation Link</th>
      <th style="text-align: center">Version</th>
      <th style="text-align: right">Check install/version</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><a href="https://www.python.org/downloads/">Python3</a></td>
      <td style="text-align: center">3.6+</td>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">python --version</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><a href="https://jupyter.org/index.html">Jupyter Notebook</a></td>
      <td style="text-align: center">4.4.0+</td>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">jupyter --version</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><a href="https://numpy.org/install/">Numpy</a></td>
      <td style="text-align: center">1.14.5+</td>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">pip list \| grep numpy</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><a href="https://matplotlib.org/users/installing.html">Matplotlib</a></td>
      <td style="text-align: center">3.0+</td>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">pip list \| grep matplotlib</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><a href="https://python-colorspace.readthedocs.io/en/latest/installation.html">Colorspace</a> or with <a href="https://pypi.org/project/colorspace/">pip</a></td>
      <td style="text-align: center">any</td>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">pip list \| grep colorspace</code></td>
    </tr>
  </tbody>
</table>

<h2 id="modeling-a-decreasing-ligand-gradient-with-a-bionetgen-function">Modeling a decreasing ligand gradient with a BioNetGen function</h2>

<p>We have simulated how the concentration of phosphorylated CheY changes when the cell moves up the attractant gradient. The concentration dips, but over time, methylation states change so that they can compensate for the increased ligand-receptor binding and restore the equilibrium of phosphorylated CheY. What if instead ligands are removed, as we would see if the bacterium is traveling <em>down</em> an attractant gradient? We might imagine that we would see an increase in phosphorylated CheY to increase tumbling and change course, followed by a return to steady-state. But is this what we will see?</p>

<p>To simulate the cell traveling down an attractant gradient, we will add a kill reaction removing unbound ligand at a constant rate. To do so, we will add the following rule within the <code class="language-plaintext highlighter-rouge">reaction rules</code> section.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#Simulate ligand removal</span>
<span class="no">LigandGone</span><span class="p">:</span> <span class="no">L</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="mi">0</span> <span class="n">k_gone</span>
</code></pre></div></div>

<p>In the <code class="language-plaintext highlighter-rouge">parameters</code> section, we start by defining <code class="language-plaintext highlighter-rouge">k_gone</code> to be 0.3, so that d[<em>L</em>]/dt = -0.3[<em>L</em>]. The solution of this differential equation is [<em>L</em>] = 10<sup>7</sup>e<sup>-0.3<em>t</em></sup>. We will also change the initial ligand concentration (<code class="language-plaintext highlighter-rouge">L0</code>) to be <code class="language-plaintext highlighter-rouge">1e7</code>. Thus, the concentration of ligand becomes so low that ligand-receptor binding reaches 0 within 50 seconds.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">k_gone</span> <span class="mf">0.3</span>
<span class="no">L0</span> <span class="mf">1e7</span>
</code></pre></div></div>

<p>We will set the initial concentrations of all <code class="language-plaintext highlighter-rouge">seed species</code> to be the final steady-state concentrations from the result for our <code class="language-plaintext highlighter-rouge">adaptation.bngl</code> model, and see if after reducing the concentration of unbound ligand gradually, the simulation can restore these concentrations to steady-state.</p>

<p>First, visit the <code class="language-plaintext highlighter-rouge">adaptation.bngl</code> model and add the concentration for each combination of methylation state and ligand binding state of the receptor complex to the <code class="language-plaintext highlighter-rouge">observables</code> section. Then run this simulation with <code class="language-plaintext highlighter-rouge">L0</code> equal to <code class="language-plaintext highlighter-rouge">1e7</code>.</p>

<p>When the simulation is finished, visit <code class="language-plaintext highlighter-rouge">RuleBender-workspace/PROJECT_NAME/results/adaptation/</code> and find the simulation result at the final time point.</p>

<p>When the model finishes running, input the final concentrations of molecules to the <code class="language-plaintext highlighter-rouge">seed species</code> section of our <code class="language-plaintext highlighter-rouge">removal.bngl</code> model. Here is what we have.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">begin</span> <span class="n">seed</span> <span class="n">species</span>
	<span class="vi">@EC</span><span class="ss">:L</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="no">L0</span>
	<span class="vi">@PM</span><span class="ss">:T</span><span class="p">(</span><span class="n">l!</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="no">Meth</span><span class="o">~</span><span class="no">A</span><span class="p">,</span><span class="no">Phos</span><span class="o">~</span><span class="no">U</span><span class="p">)</span><span class="o">.</span><span class="no">L</span><span class="p">(</span><span class="n">t!</span><span class="mi">1</span><span class="p">)</span> <span class="mi">1190</span>
	<span class="vi">@PM</span><span class="ss">:T</span><span class="p">(</span><span class="n">l!</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="no">Meth</span><span class="o">~</span><span class="no">B</span><span class="p">,</span><span class="no">Phos</span><span class="o">~</span><span class="no">U</span><span class="p">)</span><span class="o">.</span><span class="no">L</span><span class="p">(</span><span class="n">t!</span><span class="mi">1</span><span class="p">)</span> <span class="mi">2304</span>
	<span class="vi">@PM</span><span class="ss">:T</span><span class="p">(</span><span class="n">l!</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="no">Meth</span><span class="o">~</span><span class="no">C</span><span class="p">,</span><span class="no">Phos</span><span class="o">~</span><span class="no">U</span><span class="p">)</span><span class="o">.</span><span class="no">L</span><span class="p">(</span><span class="n">t!</span><span class="mi">1</span><span class="p">)</span> <span class="mi">2946</span>
	<span class="vi">@PM</span><span class="ss">:T</span><span class="p">(</span><span class="n">l!</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="no">Meth</span><span class="o">~</span><span class="no">A</span><span class="p">,</span><span class="no">Phos</span><span class="o">~</span><span class="no">P</span><span class="p">)</span><span class="o">.</span><span class="no">L</span><span class="p">(</span><span class="n">t!</span><span class="mi">1</span><span class="p">)</span> <span class="mi">2</span>
	<span class="vi">@PM</span><span class="ss">:T</span><span class="p">(</span><span class="n">l!</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="no">Meth</span><span class="o">~</span><span class="no">B</span><span class="p">,</span><span class="no">Phos</span><span class="o">~</span><span class="no">P</span><span class="p">)</span><span class="o">.</span><span class="no">L</span><span class="p">(</span><span class="n">t!</span><span class="mi">1</span><span class="p">)</span> <span class="mi">156</span>
	<span class="vi">@PM</span><span class="ss">:T</span><span class="p">(</span><span class="n">l!</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="no">Meth</span><span class="o">~</span><span class="no">C</span><span class="p">,</span><span class="no">Phos</span><span class="o">~</span><span class="no">P</span><span class="p">)</span><span class="o">.</span><span class="no">L</span><span class="p">(</span><span class="n">t!</span><span class="mi">1</span><span class="p">)</span> <span class="mi">402</span>
	<span class="vi">@CP</span><span class="ss">:CheY</span><span class="p">(</span><span class="no">Phos</span><span class="o">~</span><span class="no">U</span><span class="p">)</span> <span class="no">CheY0</span><span class="o">*</span><span class="mf">0.71</span>
	<span class="vi">@CP</span><span class="ss">:CheY</span><span class="p">(</span><span class="no">Phos</span><span class="o">~</span><span class="no">P</span><span class="p">)</span> <span class="no">CheY0</span><span class="o">*</span><span class="mf">0.29</span>
	<span class="vi">@CP</span><span class="ss">:CheZ</span><span class="p">()</span> <span class="no">CheZ0</span>
	<span class="vi">@CP</span><span class="ss">:CheB</span><span class="p">(</span><span class="no">Phos</span><span class="o">~</span><span class="no">U</span><span class="p">)</span> <span class="no">CheB0</span><span class="o">*</span><span class="mf">0.62</span>
	<span class="vi">@CP</span><span class="ss">:CheB</span><span class="p">(</span><span class="no">Phos</span><span class="o">~</span><span class="no">P</span><span class="p">)</span> <span class="no">CheB0</span><span class="o">*</span><span class="mf">0.38</span>
	<span class="vi">@CP</span><span class="ss">:CheR</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="no">CheR0</span>
<span class="k">end</span> <span class="n">seed</span> <span class="n">species</span>
</code></pre></div></div>

<h2 id="running-the-bionetgen-model">Running the BioNetGen model</h2>

<p>We are now ready to run our BioNetGen model. To do so, first add the following after <code class="language-plaintext highlighter-rouge">end model</code> to run our simulation over 1800 seconds.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">generate_network</span><span class="p">({</span><span class="n">overwrite</span><span class="o">=&gt;</span><span class="mi">1</span><span class="p">})</span>
<span class="n">simulate</span><span class="p">({</span><span class="nb">method</span><span class="o">=&gt;</span><span class="s2">"ssa"</span><span class="p">,</span> <span class="n">t_end</span><span class="o">=&gt;</span><span class="mi">1800</span><span class="p">,</span> <span class="n">n_steps</span><span class="o">=&gt;</span><span class="mi">1800</span><span class="p">})</span>
</code></pre></div></div>

<p>The following code contains our complete simulation, which can also be downloaded here: <a href="../downloads/downloadable/removal.bngl" download="removal.bngl">removal.bngl</a>.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">begin</span> <span class="n">model</span>

<span class="k">begin</span> <span class="n">molecule</span> <span class="n">types</span>
	<span class="no">L</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
	<span class="no">T</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="no">Meth</span><span class="o">~</span><span class="no">A</span><span class="o">~</span><span class="no">B</span><span class="o">~</span><span class="no">C</span><span class="p">,</span><span class="no">Phos</span><span class="o">~</span><span class="no">U</span><span class="o">~</span><span class="no">P</span><span class="p">)</span>
	<span class="no">CheY</span><span class="p">(</span><span class="no">Phos</span><span class="o">~</span><span class="no">U</span><span class="o">~</span><span class="no">P</span><span class="p">)</span>
	<span class="no">CheZ</span><span class="p">()</span>
	<span class="no">CheB</span><span class="p">(</span><span class="no">Phos</span><span class="o">~</span><span class="no">U</span><span class="o">~</span><span class="no">P</span><span class="p">)</span>
	<span class="no">CheR</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="k">end</span> <span class="n">molecule</span> <span class="n">types</span>

<span class="k">begin</span> <span class="n">observables</span>
	<span class="no">Molecules</span> <span class="n">bound_ligand</span> <span class="no">L</span><span class="p">(</span><span class="n">t!</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="no">T</span><span class="p">(</span><span class="n">l!</span><span class="mi">1</span><span class="p">)</span>
	<span class="no">Molecules</span> <span class="n">phosphorylated_CheY</span> <span class="no">CheY</span><span class="p">(</span><span class="no">Phos</span><span class="o">~</span><span class="no">P</span><span class="p">)</span>
	<span class="no">Molecules</span> <span class="n">low_methyl_receptor</span> <span class="no">T</span><span class="p">(</span><span class="no">Meth</span><span class="o">~</span><span class="no">A</span><span class="p">)</span>
	<span class="no">Molecules</span> <span class="n">medium_methyl_receptor</span> <span class="no">T</span><span class="p">(</span><span class="no">Meth</span><span class="o">~</span><span class="no">B</span><span class="p">)</span>
	<span class="no">Molecules</span> <span class="n">high_methyl_receptor</span> <span class="no">T</span><span class="p">(</span><span class="no">Meth</span><span class="o">~</span><span class="no">C</span><span class="p">)</span>
	<span class="no">Molecules</span> <span class="n">phosphorylated_CheB</span> <span class="no">CheB</span><span class="p">(</span><span class="no">Phos</span><span class="o">~</span><span class="no">P</span><span class="p">)</span>
<span class="k">end</span> <span class="n">observables</span>

<span class="k">begin</span> <span class="n">parameters</span>
	<span class="no">NaV2</span> <span class="mf">6.02e8</span>   <span class="c1">#Unit conversion to cellular concentration M/L -&gt; #/um^3</span>
	<span class="n">miu</span> <span class="mf">1e-6</span>

	<span class="no">L0</span> <span class="mf">1e7</span>
	<span class="no">T0</span> <span class="mi">7000</span>
	<span class="no">CheY0</span> <span class="mi">20000</span>
	<span class="no">CheZ0</span> <span class="mi">6000</span>
	<span class="no">CheR0</span> <span class="mi">120</span>
	<span class="no">CheB0</span> <span class="mi">250</span>

	<span class="n">k_lr_bind</span> <span class="mf">8.8e6</span><span class="o">/</span><span class="no">NaV2</span>  <span class="c1">#ligand-receptor binding</span>
	<span class="n">k_lr_dis</span> <span class="mi">35</span>            <span class="c1">#ligand-receptor dissociation</span>

	<span class="n">k_TaUnbound_phos</span> <span class="mf">7.5</span>   <span class="c1">#receptor complex autophosphorylation</span>

	<span class="n">k_Y_phos</span> <span class="mf">3.8e6</span><span class="o">/</span><span class="no">NaV2</span>   <span class="c1">#receptor complex phosphorylates Y</span>
	<span class="n">k_Y_dephos</span> <span class="mf">8.6e5</span><span class="o">/</span><span class="no">NaV2</span>  <span class="c1">#Z dephosphoryaltes Y</span>

	<span class="n">k_TR_bind</span>  <span class="mf">2e7</span><span class="o">/</span><span class="no">NaV2</span> <span class="c1">#Receptor-CheR binding</span>
	<span class="n">k_TR_dis</span>   <span class="mi">1</span>          <span class="c1">#Receptor-CheR dissociation</span>
	<span class="n">k_TaR_meth</span> <span class="mf">0.08</span>       <span class="c1">#CheR methylates receptor complex</span>

	<span class="n">k_B_phos</span> <span class="mf">1e5</span><span class="o">/</span><span class="no">NaV2</span>      <span class="c1">#CheB phosphorylation by receptor complex</span>
	<span class="n">k_B_dephos</span> <span class="mf">0.17</span>       <span class="c1">#CheB autodephosphorylation</span>

	<span class="n">k_Tb_demeth</span> <span class="mf">5e4</span><span class="o">/</span><span class="no">NaV2</span>   <span class="c1">#CheB demethylates receptor complex</span>
	<span class="n">k_Tc_demeth</span> <span class="mf">2e4</span><span class="o">/</span><span class="no">NaV2</span> <span class="c1">#CheB demethylates receptor complex</span>

	<span class="n">k_gone</span> <span class="mf">0.3</span>
<span class="k">end</span> <span class="n">parameters</span>

<span class="k">begin</span> <span class="n">reaction</span> <span class="n">rules</span>
	<span class="no">LigandReceptor</span><span class="p">:</span> <span class="no">L</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="no">T</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">&lt;-&gt;</span> <span class="no">L</span><span class="p">(</span><span class="n">t!</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="no">T</span><span class="p">(</span><span class="n">l!</span><span class="mi">1</span><span class="p">)</span> <span class="n">k_lr_bind</span><span class="p">,</span> <span class="n">k_lr_dis</span>

	<span class="c1">#Receptor complex (specifically CheA) autophosphorylation</span>
	<span class="c1">#Rate dependent on methylation and binding states</span>
	<span class="c1">#Also on free vs. bound with ligand</span>
	<span class="no">TaUnboundP</span><span class="p">:</span> <span class="no">T</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="no">Meth</span><span class="o">~</span><span class="no">A</span><span class="p">,</span><span class="no">Phos</span><span class="o">~</span><span class="no">U</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="no">T</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="no">Meth</span><span class="o">~</span><span class="no">A</span><span class="p">,</span><span class="no">Phos</span><span class="o">~</span><span class="no">P</span><span class="p">)</span> <span class="n">k_TaUnbound_phos</span>
	<span class="no">TbUnboundP</span><span class="p">:</span> <span class="no">T</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="no">Meth</span><span class="o">~</span><span class="no">B</span><span class="p">,</span><span class="no">Phos</span><span class="o">~</span><span class="no">U</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="no">T</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="no">Meth</span><span class="o">~</span><span class="no">B</span><span class="p">,</span><span class="no">Phos</span><span class="o">~</span><span class="no">P</span><span class="p">)</span> <span class="n">k_TaUnbound_phos</span><span class="o">*</span><span class="mf">1.1</span>
	<span class="no">TcUnboundP</span><span class="p">:</span> <span class="no">T</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="no">Meth</span><span class="o">~</span><span class="no">C</span><span class="p">,</span><span class="no">Phos</span><span class="o">~</span><span class="no">U</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="no">T</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="no">Meth</span><span class="o">~</span><span class="no">C</span><span class="p">,</span><span class="no">Phos</span><span class="o">~</span><span class="no">P</span><span class="p">)</span> <span class="n">k_TaUnbound_phos</span><span class="o">*</span><span class="mf">2.8</span>
	<span class="no">TaLigandP</span><span class="p">:</span> <span class="no">L</span><span class="p">(</span><span class="n">t!</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="no">T</span><span class="p">(</span><span class="n">l!</span><span class="mi">1</span><span class="p">,</span><span class="no">Meth</span><span class="o">~</span><span class="no">A</span><span class="p">,</span><span class="no">Phos</span><span class="o">~</span><span class="no">U</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="no">L</span><span class="p">(</span><span class="n">t!</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="no">T</span><span class="p">(</span><span class="n">l!</span><span class="mi">1</span><span class="p">,</span><span class="no">Meth</span><span class="o">~</span><span class="no">A</span><span class="p">,</span><span class="no">Phos</span><span class="o">~</span><span class="no">P</span><span class="p">)</span> <span class="mi">0</span>
	<span class="no">TbLigandP</span><span class="p">:</span> <span class="no">L</span><span class="p">(</span><span class="n">t!</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="no">T</span><span class="p">(</span><span class="n">l!</span><span class="mi">1</span><span class="p">,</span><span class="no">Meth</span><span class="o">~</span><span class="no">B</span><span class="p">,</span><span class="no">Phos</span><span class="o">~</span><span class="no">U</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="no">L</span><span class="p">(</span><span class="n">t!</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="no">T</span><span class="p">(</span><span class="n">l!</span><span class="mi">1</span><span class="p">,</span><span class="no">Meth</span><span class="o">~</span><span class="no">B</span><span class="p">,</span><span class="no">Phos</span><span class="o">~</span><span class="no">P</span><span class="p">)</span> <span class="n">k_TaUnbound_phos</span><span class="o">*</span><span class="mf">0.8</span>
	<span class="no">TcLigandP</span><span class="p">:</span> <span class="no">L</span><span class="p">(</span><span class="n">t!</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="no">T</span><span class="p">(</span><span class="n">l!</span><span class="mi">1</span><span class="p">,</span><span class="no">Meth</span><span class="o">~</span><span class="no">C</span><span class="p">,</span><span class="no">Phos</span><span class="o">~</span><span class="no">U</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="no">L</span><span class="p">(</span><span class="n">t!</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="no">T</span><span class="p">(</span><span class="n">l!</span><span class="mi">1</span><span class="p">,</span><span class="no">Meth</span><span class="o">~</span><span class="no">C</span><span class="p">,</span><span class="no">Phos</span><span class="o">~</span><span class="no">P</span><span class="p">)</span> <span class="n">k_TaUnbound_phos</span><span class="o">*</span><span class="mf">1.6</span>

	<span class="c1">#CheY phosphorylation by T and dephosphorylation by CheZ</span>
	<span class="no">YPhos</span><span class="p">:</span> <span class="no">T</span><span class="p">(</span><span class="no">Phos</span><span class="o">~</span><span class="no">P</span><span class="p">)</span> <span class="o">+</span> <span class="no">CheY</span><span class="p">(</span><span class="no">Phos</span><span class="o">~</span><span class="no">U</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="no">T</span><span class="p">(</span><span class="no">Phos</span><span class="o">~</span><span class="no">U</span><span class="p">)</span> <span class="o">+</span> <span class="no">CheY</span><span class="p">(</span><span class="no">Phos</span><span class="o">~</span><span class="no">P</span><span class="p">)</span> <span class="n">k_Y_phos</span>
	<span class="no">YDephos</span><span class="p">:</span> <span class="no">CheZ</span><span class="p">()</span> <span class="o">+</span> <span class="no">CheY</span><span class="p">(</span><span class="no">Phos</span><span class="o">~</span><span class="no">P</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="no">CheZ</span><span class="p">()</span> <span class="o">+</span> <span class="no">CheY</span><span class="p">(</span><span class="no">Phos</span><span class="o">~</span><span class="no">U</span><span class="p">)</span> <span class="n">k_Y_dephos</span>

	<span class="c1">#CheR binds to and methylates receptor complex</span>
	<span class="c1">#Rate dependent on methylation states and ligand binding</span>
	<span class="no">TRBind</span><span class="p">:</span> <span class="no">T</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">+</span> <span class="no">CheR</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">&lt;-&gt;</span> <span class="no">T</span><span class="p">(</span><span class="n">r!</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="no">CheR</span><span class="p">(</span><span class="n">t!</span><span class="mi">2</span><span class="p">)</span> <span class="n">k_TR_bind</span><span class="p">,</span> <span class="n">k_TR_dis</span>
	<span class="no">TaRUnboundMeth</span><span class="p">:</span> <span class="no">T</span><span class="p">(</span><span class="n">r!</span><span class="mi">2</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="no">Meth</span><span class="o">~</span><span class="no">A</span><span class="p">)</span><span class="o">.</span><span class="no">CheR</span><span class="p">(</span><span class="n">t!</span><span class="mi">2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="no">T</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="no">Meth</span><span class="o">~</span><span class="no">B</span><span class="p">)</span> <span class="o">+</span> <span class="no">CheR</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="n">k_TaR_meth</span>
	<span class="no">TbRUnboundMeth</span><span class="p">:</span> <span class="no">T</span><span class="p">(</span><span class="n">r!</span><span class="mi">2</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="no">Meth</span><span class="o">~</span><span class="no">B</span><span class="p">)</span><span class="o">.</span><span class="no">CheR</span><span class="p">(</span><span class="n">t!</span><span class="mi">2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="no">T</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="no">Meth</span><span class="o">~</span><span class="no">C</span><span class="p">)</span> <span class="o">+</span> <span class="no">CheR</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="n">k_TaR_meth</span><span class="o">*</span><span class="mf">0.1</span>
	<span class="no">TaRLigandMeth</span><span class="p">:</span> <span class="no">T</span><span class="p">(</span><span class="n">r!</span><span class="mi">2</span><span class="p">,</span><span class="n">l!</span><span class="mi">1</span><span class="p">,</span><span class="no">Meth</span><span class="o">~</span><span class="no">A</span><span class="p">)</span><span class="o">.</span><span class="no">L</span><span class="p">(</span><span class="n">t!</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="no">CheR</span><span class="p">(</span><span class="n">t!</span><span class="mi">2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="no">T</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">l!</span><span class="mi">1</span><span class="p">,</span><span class="no">Meth</span><span class="o">~</span><span class="no">B</span><span class="p">)</span><span class="o">.</span><span class="no">L</span><span class="p">(</span><span class="n">t!</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="no">CheR</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="n">k_TaR_meth</span><span class="o">*</span><span class="mi">30</span>
	<span class="no">TbRLigandMeth</span><span class="p">:</span> <span class="no">T</span><span class="p">(</span><span class="n">r!</span><span class="mi">2</span><span class="p">,</span><span class="n">l!</span><span class="mi">1</span><span class="p">,</span><span class="no">Meth</span><span class="o">~</span><span class="no">B</span><span class="p">)</span><span class="o">.</span><span class="no">L</span><span class="p">(</span><span class="n">t!</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="no">CheR</span><span class="p">(</span><span class="n">t!</span><span class="mi">2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="no">T</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">l!</span><span class="mi">1</span><span class="p">,</span><span class="no">Meth</span><span class="o">~</span><span class="no">C</span><span class="p">)</span><span class="o">.</span><span class="no">L</span><span class="p">(</span><span class="n">t!</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="no">CheR</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="n">k_TaR_meth</span><span class="o">*</span><span class="mi">3</span>

	<span class="c1">#CheB is phosphorylated by receptor complex, and autodephosphorylates</span>
	<span class="no">CheBphos</span><span class="p">:</span> <span class="no">T</span><span class="p">(</span><span class="no">Phos</span><span class="o">~</span><span class="no">P</span><span class="p">)</span> <span class="o">+</span> <span class="no">CheB</span><span class="p">(</span><span class="no">Phos</span><span class="o">~</span><span class="no">U</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="no">T</span><span class="p">(</span><span class="no">Phos</span><span class="o">~</span><span class="no">U</span><span class="p">)</span> <span class="o">+</span> <span class="no">CheB</span><span class="p">(</span><span class="no">Phos</span><span class="o">~</span><span class="no">P</span><span class="p">)</span> <span class="n">k_B_phos</span>
	<span class="no">CheBdephos</span><span class="p">:</span> <span class="no">CheB</span><span class="p">(</span><span class="no">Phos</span><span class="o">~</span><span class="no">P</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="no">CheB</span><span class="p">(</span><span class="no">Phos</span><span class="o">~</span><span class="no">U</span><span class="p">)</span> <span class="n">k_B_dephos</span>

	<span class="c1">#CheB demethylates receptor complex</span>
	<span class="c1">#Rate dependent on methyaltion states</span>
	<span class="no">TbDemeth</span><span class="p">:</span> <span class="no">T</span><span class="p">(</span><span class="no">Meth</span><span class="o">~</span><span class="no">B</span><span class="p">)</span> <span class="o">+</span> <span class="no">CheB</span><span class="p">(</span><span class="no">Phos</span><span class="o">~</span><span class="no">P</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="no">T</span><span class="p">(</span><span class="no">Meth</span><span class="o">~</span><span class="no">A</span><span class="p">)</span> <span class="o">+</span> <span class="no">CheB</span><span class="p">(</span><span class="no">Phos</span><span class="o">~</span><span class="no">P</span><span class="p">)</span> <span class="n">k_Tb_demeth</span>
	<span class="no">TcDemeth</span><span class="p">:</span> <span class="no">T</span><span class="p">(</span><span class="no">Meth</span><span class="o">~</span><span class="no">C</span><span class="p">)</span> <span class="o">+</span> <span class="no">CheB</span><span class="p">(</span><span class="no">Phos</span><span class="o">~</span><span class="no">P</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="no">T</span><span class="p">(</span><span class="no">Meth</span><span class="o">~</span><span class="no">B</span><span class="p">)</span> <span class="o">+</span> <span class="no">CheB</span><span class="p">(</span><span class="no">Phos</span><span class="o">~</span><span class="no">P</span><span class="p">)</span> <span class="n">k_Tc_demeth</span>

	<span class="c1">#Simulate ligand removal</span>
	<span class="no">LigandGone</span><span class="p">:</span> <span class="no">L</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="mi">0</span> <span class="n">k_gone</span>

<span class="k">end</span> <span class="n">reaction</span> <span class="n">rules</span>

<span class="k">begin</span> <span class="n">compartments</span>
  <span class="no">EC</span>  <span class="mi">3</span>  <span class="mi">100</span>       <span class="c1">#um^3</span>
  <span class="no">PM</span>  <span class="mi">2</span>  <span class="mi">1</span>   <span class="no">EC</span>    <span class="c1">#um^2</span>
  <span class="no">CP</span>  <span class="mi">3</span>  <span class="mi">1</span>   <span class="no">PM</span>    <span class="c1">#um^3</span>
<span class="k">end</span> <span class="n">compartments</span>

<span class="k">begin</span> <span class="n">seed</span> <span class="n">species</span>
	<span class="vi">@EC</span><span class="ss">:L</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="no">L0</span>
	<span class="vi">@PM</span><span class="ss">:T</span><span class="p">(</span><span class="n">l!</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="no">Meth</span><span class="o">~</span><span class="no">A</span><span class="p">,</span><span class="no">Phos</span><span class="o">~</span><span class="no">U</span><span class="p">)</span><span class="o">.</span><span class="no">L</span><span class="p">(</span><span class="n">t!</span><span class="mi">1</span><span class="p">)</span> <span class="mi">1190</span>
	<span class="vi">@PM</span><span class="ss">:T</span><span class="p">(</span><span class="n">l!</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="no">Meth</span><span class="o">~</span><span class="no">B</span><span class="p">,</span><span class="no">Phos</span><span class="o">~</span><span class="no">U</span><span class="p">)</span><span class="o">.</span><span class="no">L</span><span class="p">(</span><span class="n">t!</span><span class="mi">1</span><span class="p">)</span> <span class="mi">2304</span>
	<span class="vi">@PM</span><span class="ss">:T</span><span class="p">(</span><span class="n">l!</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="no">Meth</span><span class="o">~</span><span class="no">C</span><span class="p">,</span><span class="no">Phos</span><span class="o">~</span><span class="no">U</span><span class="p">)</span><span class="o">.</span><span class="no">L</span><span class="p">(</span><span class="n">t!</span><span class="mi">1</span><span class="p">)</span> <span class="mi">2946</span>
	<span class="vi">@PM</span><span class="ss">:T</span><span class="p">(</span><span class="n">l!</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="no">Meth</span><span class="o">~</span><span class="no">A</span><span class="p">,</span><span class="no">Phos</span><span class="o">~</span><span class="no">P</span><span class="p">)</span><span class="o">.</span><span class="no">L</span><span class="p">(</span><span class="n">t!</span><span class="mi">1</span><span class="p">)</span> <span class="mi">2</span>
	<span class="vi">@PM</span><span class="ss">:T</span><span class="p">(</span><span class="n">l!</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="no">Meth</span><span class="o">~</span><span class="no">B</span><span class="p">,</span><span class="no">Phos</span><span class="o">~</span><span class="no">P</span><span class="p">)</span><span class="o">.</span><span class="no">L</span><span class="p">(</span><span class="n">t!</span><span class="mi">1</span><span class="p">)</span> <span class="mi">156</span>
	<span class="vi">@PM</span><span class="ss">:T</span><span class="p">(</span><span class="n">l!</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="no">Meth</span><span class="o">~</span><span class="no">C</span><span class="p">,</span><span class="no">Phos</span><span class="o">~</span><span class="no">P</span><span class="p">)</span><span class="o">.</span><span class="no">L</span><span class="p">(</span><span class="n">t!</span><span class="mi">1</span><span class="p">)</span> <span class="mi">402</span>
	<span class="vi">@CP</span><span class="ss">:CheY</span><span class="p">(</span><span class="no">Phos</span><span class="o">~</span><span class="no">U</span><span class="p">)</span> <span class="no">CheY0</span><span class="o">*</span><span class="mf">0.71</span>
	<span class="vi">@CP</span><span class="ss">:CheY</span><span class="p">(</span><span class="no">Phos</span><span class="o">~</span><span class="no">P</span><span class="p">)</span> <span class="no">CheY0</span><span class="o">*</span><span class="mf">0.29</span>
	<span class="vi">@CP</span><span class="ss">:CheZ</span><span class="p">()</span> <span class="no">CheZ0</span>
	<span class="vi">@CP</span><span class="ss">:CheB</span><span class="p">(</span><span class="no">Phos</span><span class="o">~</span><span class="no">U</span><span class="p">)</span> <span class="no">CheB0</span><span class="o">*</span><span class="mf">0.62</span>
	<span class="vi">@CP</span><span class="ss">:CheB</span><span class="p">(</span><span class="no">Phos</span><span class="o">~</span><span class="no">P</span><span class="p">)</span> <span class="no">CheB0</span><span class="o">*</span><span class="mf">0.38</span>
	<span class="vi">@CP</span><span class="ss">:CheR</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="no">CheR0</span>
<span class="k">end</span> <span class="n">seed</span> <span class="n">species</span>

<span class="k">end</span> <span class="n">model</span>

<span class="n">generate_network</span><span class="p">({</span><span class="n">overwrite</span><span class="o">=&gt;</span><span class="mi">1</span><span class="p">})</span>
<span class="n">simulate</span><span class="p">({</span><span class="nb">method</span><span class="o">=&gt;</span><span class="s2">"ssa"</span><span class="p">,</span> <span class="n">t_end</span><span class="o">=&gt;</span><span class="mi">1800</span><span class="p">,</span> <span class="n">n_steps</span><span class="o">=&gt;</span><span class="mi">1800</span><span class="p">})</span>
</code></pre></div></div>

<p>Save your file, and then visit <code class="language-plaintext highlighter-rouge">simulation</code> and click <code class="language-plaintext highlighter-rouge">Run</code>. What happens to the concentration of phosphorylated CheY? Are the concentrations of complexes at different methylation states restored to their levels before adding ligands to the <code class="language-plaintext highlighter-rouge">adaptation.bngl</code> model?</p>

<p>As we did in the tutorial simulating increasing ligand, we can try different values for <code class="language-plaintext highlighter-rouge">k_gone</code>. Change <code class="language-plaintext highlighter-rouge">t_end</code> in the <code class="language-plaintext highlighter-rouge">simulate</code> method to 1800 seconds, and run the simulation with <code class="language-plaintext highlighter-rouge">k_gone</code> equal to 0.01, 0.03, 0.05, 0.1, and 0.5.</p>

<p>All simulation results are stored in the <code class="language-plaintext highlighter-rouge">RuleBender-workspace/PROJECT_NAME/results/MODEL_NAME/TIME/</code> directory in your computer. Rename the directory with the <code class="language-plaintext highlighter-rouge">k_gone</code> values instead of the timestamp for simplicity.</p>

<h2 id="visualizing-the-results-of-our-simulation">Visualizing the results of our simulation</h2>

<p>We will use the jupyter notebook <a href="../downloads/downloadable/plotter_up.ipynb" download="plotter_up.ipynb">plotter_up.ipynb</a> as a template for the <code class="language-plaintext highlighter-rouge">plotter_down.ipynb</code> file that we will use to visualize our results. First, we will specify the directories, model name, species of interest, and reaction rates. Put the <code class="language-plaintext highlighter-rouge">RuleBender-workspace/PROJECT_NAME/results/MODEL_NAME/</code> folder inside the same directory as the Jupyter notebook or change the <code class="language-plaintext highlighter-rouge">model_path</code> accordingly.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">model_path</span> <span class="o">=</span> <span class="s">"removal"</span>  <span class="c1">#The folder containing the model
</span><span class="n">model_name</span> <span class="o">=</span> <span class="s">"removal"</span>  <span class="c1">#Name of the model
</span><span class="n">target</span> <span class="o">=</span> <span class="s">"phosphorylated_CheY"</span>    <span class="c1">#Target molecule
</span><span class="n">vals</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]</span>  <span class="c1">#Gradients of interest
</span></code></pre></div></div>

<p>The second code block is the same as that provided in the <a href="tutorial_gradient">previous tutorial</a>. This code loads the simulation result at each time point from the <code class="language-plaintext highlighter-rouge">.gdat</code> file, which stores the concentration of all <code class="language-plaintext highlighter-rouge">observables</code> at all steps. It then plots the concentration of phosphorylated CheY over time.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">colorspace</span>


<span class="c1">#Define the colors to use
</span><span class="n">colors</span> <span class="o">=</span> <span class="n">colorspace</span><span class="p">.</span><span class="n">qualitative_hcl</span><span class="p">(</span><span class="n">h</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">300.</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">60</span><span class="p">,</span> <span class="n">l</span> <span class="o">=</span> <span class="mi">70</span><span class="p">,</span> <span class="n">pallete</span> <span class="o">=</span> <span class="s">"dynamic"</span><span class="p">)(</span><span class="nb">len</span><span class="p">(</span><span class="n">vals</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">load_data</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
    <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_path</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">),</span> <span class="n">model_name</span> <span class="o">+</span> <span class="s">".gdat"</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">first_line</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="n">readline</span><span class="p">()</span> <span class="c1">#Read the first line
</span>    <span class="n">cols</span> <span class="o">=</span> <span class="n">first_line</span><span class="p">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">:]</span> <span class="c1">#Get the col names (species names)
</span>
    <span class="n">ind</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">cols</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">!=</span> <span class="n">target</span><span class="p">:</span>
        <span class="n">ind</span> <span class="o">+=</span> <span class="mi">1</span>                  <span class="c1">#Get col number of target molecule
</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>  <span class="c1">#Load the file
</span>    <span class="n">time</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>             <span class="c1">#Time points
</span>    <span class="n">concentration</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="n">ind</span><span class="p">]</span>  <span class="c1">#Concentrations
</span>
    <span class="k">return</span> <span class="n">time</span><span class="p">,</span> <span class="n">concentration</span>


<span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">concentration</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
    <span class="n">legend</span> <span class="o">=</span> <span class="s">"k = - "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">concentration</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">legend</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="k">return</span>


<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vals</span><span class="p">)):</span>
    <span class="n">val</span> <span class="o">=</span> <span class="n">vals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">time</span><span class="p">,</span> <span class="n">concentration</span> <span class="o">=</span> <span class="n">load_data</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
    <span class="n">plot</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">concentration</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>

<span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">"time"</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">"concentration (#molecules)"</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">title</span><span class="p">(</span><span class="s">"Active CheY vs time"</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="n">minorticks_on</span><span class="p">()</span>
<span class="n">ax</span><span class="p">.</span><span class="n">grid</span><span class="p">(</span><span class="n">b</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">which</span> <span class="o">=</span> <span class="s">'minor'</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="s">'both'</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">'lightgrey'</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s">':'</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="n">grid</span><span class="p">(</span><span class="n">b</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">which</span> <span class="o">=</span> <span class="s">'major'</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="s">'both'</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">'grey'</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">0.8</span> <span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s">':'</span><span class="p">)</span>

<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p>Run the notebook. How does the value of <code class="language-plaintext highlighter-rouge">k_gone</code> impact the concentration of phosphorylated CheY? Why? Are the tumbling frequencies restored to the background frequency? As we return to the main text, we will show the resulting plots and discuss these questions.</p>

<p style="font-size: 100%; text-align: center;"><a href="home_gradient#steady-state-tumbling-frequency-remains-robust-when-traveling-down-an-attractant-gradient" class="btn btn--primary btn--large">Return to main text</a></p>

        
      </section>

      <footer class="page__meta">
        
        


        

      </footer>

      

      
    </div>

    
  </article>

  <!-- only show related on a post page when `related: true`
  
  
  -->
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><div class="search-searchbar"></div>
  <div class="search-hits"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <hr>
  <a href="http://cbd.cmu.edu" target="_blank"><img align = "left" src="../assets/images/CMU_CBD_logos.png" alt="CBD Logo" width="40%" height="40%"></a>
  <a href="http://mmbios.pitt.edu" target="_blank"><img align="right" src="../assets/images/MMBioS_Logo.png" alt="MMBioS Logo" width="50%" height="50%"></a>
</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>


<!-- Including InstantSearch.js library and styling -->
<script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3.3/dist/instantsearch.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3.3/dist/instantsearch.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3.3/dist/instantsearch-theme-algolia.min.css">

<script>
// Instanciating InstantSearch.js with Algolia credentials
const search = instantsearch({
  appId: 'O24616B64D',
  apiKey: '3d5df9a350e2a9a5039314b58ef8c32d',
  indexName: 'biological_modeling',
  searchParameters: {
    restrictSearchableAttributes: [
      'title',
      'content'
    ]
  }
});

const hitTemplate = function(hit) {
  const url = hit.url;
  const title = hit._highlightResult.title.value;
  const content = hit._highlightResult.html.value;

  return `
    <div class="list__item">
      <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
        <h2 class="archive__item-title" itemprop="headline"><a href="${url}">${title}</a></h2>
        <div class="archive__item-excerpt" itemprop="description">${content}</div>
      </article>
    </div>
  `;
}

// Adding searchbar and results widgets
search.addWidget(
  instantsearch.widgets.searchBox({
    container: '.search-searchbar',
    poweredBy: true,
    placeholder: 'Enter your search term...'
  })
);
search.addWidget(
  instantsearch.widgets.hits({
    container: '.search-hits',
    templates: {
      item: hitTemplate,
      empty: 'No results',
    }
  })
);

// Starting the search only when toggle is clicked
$(document).ready(function () {
  $(".search__toggle").on("click", function() {
    if(!search.started) {
      search.start();
    }
  });
});
</script>








  </body>
</html>
