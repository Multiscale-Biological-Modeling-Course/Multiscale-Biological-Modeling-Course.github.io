\phantomsection
\chapter[Random Walks and Turing Patterns]{Random Walks and Turing Patterns\chapsubhead{Noah Lee, Mert Inan, and Phillip Compeau}}
\label{chapter:turing}
\renewcommand{\chaptertitle}{Finding Motifs in Transcription Factor Networks}
\addcontentsline{cc}{chapter}{Chapter \thechapter} % Adds chapter number to table of contents

\FloatBarrier

\section{Alan Turing and the Zebra’s Stripes}
\label{sec:introduction}
\phantomsection

If you are familiar with Alan Turing, then you might be surprised that a famous computer scientist would appear in the first sentence of a book on biological modeling, since he is most famous for two other acts. In 1936, he theorized a computer (which came to be known as a ``Turing machine'') consisting of a tape of cells along with a machine that writes symbols on the tape according to a set of predetermined set of rules, a machine that is simple but nevertheless has been shown to be capable of solving any problem that a modern computer can solve.  And during World War II, he worked at Bletchley Park to devise machines that would be used to break several German ciphers.

%\begin{figure}[h]
%\centering
%\mySfFamily
%\includegraphics[width = 0.4\textwidth]{../images/alan_turing_npg_cc.jpg}
%\caption{Alan Turing in 1951. © National Portrait Gallery, London.}
%\label{fig:alan_turing_npg_cc}
%\end{figure}

In 1952, two years before his untimely demise, Turing published his only paper on biochemistry, which addressed the question: “Why do zebras have stripes?” He was not asking why zebras have \textit{evolved} to have stripes --- this question was unsolved in Turing's time, and recent research has indicated that the stripes may be helpful in warding off flies. Rather, Turing was interested in what biochemical mechanism could produce the stripes that we see on a zebra's coat. And he reasoned that just as a simple machine can emulate a computer, some limited set of molecular ``rules'' could cause stripes to appear on a zebra's coat.

In this chapter, we will introduce a particle simulation model based on Turing's ideas. We will see that a system built on very simple rules and even \textit{randomness} can nevertheless produce emergent behavior that is complex and elegant. And we will explore how this model can be tweaked to provide a hypothesis for the origin of not just the zebra's stripes but also the leopard's spots.\\

\FloatBarrier
\phantomsection

\section{An Overview of Random Walks}
\label{sec:an_overview_of_random_walks}
\phantomsection

You may feel like a single, coherent being, but you are in fact just a skin-covered bag of trillions of cells --- about half of which are bacteria --- that act largely independently. These cells are full of \textdef{proteins}{protein}{a complex macromolecule formed of chain(s) of amino acids that perform nearly every cellular function}, complex macromolecules that perform nearly every cellular function. If a protein could move in a straight line, then it would move at 20 kph or faster, meaning that the protein would cover a distance 1 billion times its length every second (analogous to a car traveling at 20 billion kph). However, the cytoplasm filling the cell is so densely packed with water molecules that the protein ping-pongs off them, frequently changing direction.

We will model the movements of a cellular particle such as a protein by a \textdef{random walk}{random walk}{a model consisting of a sequence of steps in randomly chosen directions} in a two-dimensional plane. At each step, the particle moves a single unit of distance in a randomly chosen direction.

If we animate the action of many independent particles following random walks, then although some particles hug the starting point and some wind up far away, most particles steadily drift outward. \autoref{fig:random_walk_multiple_particles} shows a simulation of multiple randomly walking particles that all begin their walk at the same point.\\

\begin{figure}[h]
\centering
\mySfFamily
\tabcolsep=1em
\begin{tabular}{c c c c}
\includegraphics[width=0.25\textwidth]{../images/random_walk_particles_1} & \includegraphics[width=0.25\textwidth]{../images/random_walk_particles_2} & \includegraphics[width=0.25\textwidth]{../images/random_walk_particles_4}\\
\end{tabular}
\caption{Three time points captured from an animation of randomly walking particles all starting at the origin. As time advances from left to right, the points tend to drift outward.}
\label{fig:random_walk_multiple_particles}
\end{figure}

Although the movements of a single particle are random, we can draw conclusions about the \textit{average-case} behavior of many particles can be predicted, as the following theorem indicates.

\textbf{Random Walk Theorem:} After \textvar{n} steps of unit length in a random walk, a particle will on average find itself a distance from its origin that is proportional to $\sqrt{n}$.\\

\begin{note}[%
For those who love mathematics, we provide a proof of this theorem in an appendix.
]\end{note}

Our experience of the world confirms the Random Walk Theorem's statement that randomly walking particles tend to drift away from their starting point. We understand, for example, that an infected COVID-19 patient can infect many others in an enclosed space in a short time frame. To take a less morbid example, we also know that when a cake is baking in the oven at home, we will not need to wait long for wonderful smells to waft outward from the kitchen.

If you are interested in seeing how to build the random walk simulation shown in the video above, then please visit the following software tutorial. This tutorial uses \textdefnogloss{CellBlender}, an add-on to the popular open graphics software program  \textdefnogloss{Blender}, which allows us to create and visualize biological models. These models rely on particle-based reaction-diffusion simulations that are implemented by the program  \textdefnogloss{MCell}. We will use this software for our work in biological modeling in this chapter as well as \autoref{chapter:motifs}.\\

\begin{note}[%
We have designed this book so that you can appreciate the key ideas behind the biological models that we build without following software tutorials. But we also provide these tutorials so that you can explore the modeling software that we have used to generate our conclusions.
]\end{note}

\tutorial[https://biologicalmodeling.org/prologue/tutorial-random-walk]

Why should scientists care about random walks? Later in this book, we will see that random walks power a simple but powerful approach that bacteria like \textit{E. coli} use to explore their environment in the hunt for food. In the next section, we will see that randomly moving particles serve can produce high-level patterns if the particles interact when they collide.\\

\FloatBarrier
\phantomsection

\section{A Reaction-Diffusion Model Generating Turing Patterns}
\label{sec:a_reaction-diffusion_model_generating_turing_patterns}
\phantomsection

\subsection{From random walks to reaction-diffusion}

In the previous section, we introduced the model of a particle randomly walking through a medium. But what exactly do random walks have to do with Alan Turing and zebras?

Turing's insight was that remarkable high-level patterns could arise if we combine particle diffusion with a chemical reaction in which colliding particles interact with each other. Such a model is called a \textdef{reaction-diffusion system}{reaction-diffusion system}{a model incorporating the diffusion of particles with chemical reactions involving these particles}, and the emergent patterns are called \textdef{Turing patterns}{Turing patterns}{patterns, such as stripes and spots, that emerge from certain reaction-diffusion systems} in Turing's honor.

We will consider a reaction-diffusion system having two types of particles, \textvar{A} and \textvar{B}. The system is not explicitly a predator-prey relationship, but you may like to think of the \textvar{A} particles as prey and the \textvar{B} particles as predators for reasons that will become clear soon.

Both types of particles diffuse randomly through the plane, but the \textvar{A} particles diffuse more quickly than the \textvar{B} particles.  In the simulation that follows, we will assume that \textvar{A} particles diffuse twice as quickly as \textvar{B} particles. In terms of our random walk model, this faster rate of diffusion means that in a single ``step'', an \textvar{A} particle moves twice as far as a \textvar{B} particle.\\

\begin{qbox}[%
Say that we release one \textvar{A} particle and one \textvar{B} particle at the same location. If the two particles move via random walks, and the rate of diffusion of \textvar{A} is twice as fast, then on average how much farther from the origin will \textvar{A} be than \textvar{B} after \textvar{n} steps?
]\end{qbox}

We now will add some reactions to our system. The \textvar{A} particles are added into the system at some constant \textdefnogloss{feed rate} \textvar{f}. As a result of the feed reaction, the concentration of the \textvar{A} particles increases by a constant number in each time step.\\

\begin{note}[%
We will work with a two-dimensional simulation, but in a three-dimensional system, the units of \textvar{f} would be in mol/L/s, which means that every second, there are \textvar{f} moles of particles added to the system for every liter of volume. (Recall from your chemistry class long ago that one mole is $6.02214076 \cdot 10^{23}$ particles, called Avogadro's number.)
]\end{note}

There is also a \textdefnogloss{kill rate} constant \textvar{k} dictating the rate of removal of \textvar{B} particles. As a result of the kill reaction, the number of \textvar{B} particles in the system will decrease by a factor of \textvar{k} in a given time step. That is, the more \textvar{B} particles that are present, the more \textvar{B} particles will be removed.

Finally, our reaction-diffusion system includes the following reaction involving both particle types. The particles on the left side of this reaction are called \textdef{reactants}{reactants}{substances taking part in a reaction} and the particles on the right side are called \textdef{products}{products}{substances resulting from a reaction}.

\begin{center}
$A + 2B \rightarrow 3B$
\end{center}

To simulate this reaction on a particle level, if an \textvar{A} particle and two \textvar{B} particles collide with each other, then the \textvar{A} particle has some fixed probability of being replaced by a third \textvar{B} particle, which could vary based on the presence of a catalyst and the orientation of the particles. This probability directly relates to the \textit{rate} at which this reaction occurs, which is denoted \textvar{r} and also depends on the concentrations of \textvar{A} and \textvar{B} as well as their kinetic energy.

This third reaction is why we compared \textvar{A} to prey and \textvar{B} to predators, since we may like to conceptualize the reaction as two \textvar{B} particles consuming an \textvar{A} particle and producing an offspring \textvar{B} particle.

The three reactions defining our system are summarized by \autoref{fig:three_reactions}.\\

\begin{figure}[h]
\centering
\mySfFamily
\tabcolsep=2em
\begin{tabular}{c c}
\includegraphics[width=0.35\textwidth]{../images/reaction-diffusion_three_reactions_before} & \includegraphics[width=0.35\textwidth]{../images/reaction-diffusion_three_reactions_after}\\
\end{tabular}
\caption{Visualization of our reaction-diffusion system. (Left) The system contains both types of particles and two collisions of particles. (Right) Two \textvar{A} particles are fed into the system, two of the \textvar{B} particles die out, and a \textvar{B} particle replaces an \textvar{A} particle after the collision of three particles.}
\label{fig:three_reactions}
\end{figure}

Before continuing, we call your attention to a slight difference between the feed and kill reactions. In the former, the number of \textvar{A} particles increases by a constant number in each time step. In the latter, the number of \textvar{B} particles decreases by a constant factor multiplied by the current number of \textvar{B} particles. If we were using calculus to model this system, then letting [\textvar{A}] and [\textvar{B}] denote the concentrations of the two particle types, we can write

\begin{center}
$\dfrac{\mathrm{d}[A]}{\mathrm{d}t} = f$
\end{center}

\noindent and

\begin{center}
$\dfrac{\mathrm{d}[B]}{\mathrm{d}t} = k \cdot [B]$\,.
\end{center}

\FloatBarrier
\phantomsection
\subsection{Parameters are omnipresent in biological modeling}

Before building a simulation corresponding to our reaction-diffusion model, we point out that the results of the simulation can vary depending upon a few things.

A \textdef{parameter}{parameter}{a variable used as input to a model} is a variable quantity used as input to a model. Parameters are inevitable in biological modeling (and data science in general), and as we will see, changing parameters can cause major changes in the behavior of a system.

Four parameters are relevant to our reaction-diffusion system. Three of these parameters are the feed rate (\textvar{f}) of \textvar{A} particles, the kill rate of the \textvar{B} particles (\textvar{k}), and the rate of the predator-prey reaction (\textvar{r}). The final parameter of interest corresponds to the diffusion rate (i.e., speeds) of the the \textvar{B} particles. Once this diffusion rate is set, the diffusion rate of \textvar{A} particles must be twice that of the \textvar{B} particles.

We think of all these parameters as dials that we can turn, observing how the system changes as a result. For example, if we raise the diffusion rate, then the particles will be moving around and bouncing into each other more, which means that we will see more of the reaction $\textvar{A} + 2\textvar{B} \rightarrow 3\textvar{B}$.\\

\begin{qbox}[%
What will happen as we increase or decrease the feed rate \textvar{f}? What about the kill rate \textvar{k}?
]\end{qbox}

The same goes for the feed and kill reactions; new \textvar{A} particles are formed, and old \textvar{B} particles are destroyed, via probabilities that are computed from reaction rates. For now, you can think of the rate of a reaction as directly related to its probability of occurring.

In the following tutorial, we will initiate our reaction-diffusion system with a uniform concentration of \textvar{A} particles spread across the grid and a tightly packed collection of \textvar{B} particles in the center of the grid. When we return from this tutorial, we will see if any high-level patterns form.

\tutorial[https://biologicalmodeling.org/prologue/turing-cellblender]

\FloatBarrier
\phantomsection
\subsection{Changing reaction-diffusion parameters produces different emergent Turing patterns}

For many parameter values, our reaction-diffusion system is not very interesting.  For example, \autoref{fig:k=500000_f=1000} illustrates the result of a simulation using parameter rates in CellBlender of \textvar{f} = 1000 and \textvar{k} = 500,000.  It shows that if the kill rate is too high, then the \textvar{B} particles (colored red) will die out more quickly than they can be replenished by the reaction with \textvar{A} particles (colored green), and so only \textvar{A} particles will be left.\\

\begin{figure}[h]
\centering
\mySfFamily
\begin{tabular}{c c c c}
\includegraphics[width = 0.2\textwidth]{../images/predator_prey_predator_dies_f1e1_r5e5.png} & \includegraphics[width = 0.2\textwidth]{../images/../images/predator_prey_predator_dies_f1e1_r5e5_i1.png} & \includegraphics[width = 0.2\textwidth]{../images/../images/predator_prey_predator_dies_f1e1_r5e5_i2.png} & \includegraphics[width = 0.2\textwidth]{../images/../images/predator_prey_predator_dies_f1e1_r5e5_i3.png}\\[2ex]
\includegraphics[width = 0.2\textwidth]{../images/predator_prey_predator_dies_f1e1_r5e5_i4.png} & \includegraphics[width = 0.2\textwidth]{../images/../images/predator_prey_predator_dies_f1e1_r5e5_i5.png} & \includegraphics[width = 0.2\textwidth]{../images/../images/predator_prey_predator_dies_f1e1_r5e5_i6.png} & \includegraphics[width = 0.2\textwidth]{../images/../images/predator_prey_predator_dies_f1e1_r5e5_i7.png}
\end{tabular}
\caption{CAPTION NEEDED}
\label{fig:k=500000_f=1000}
\end{figure}

On the other hand, if \textvar{f} is too high, then the increased feed rate will cause an increase in the concentration of \textvar{A} particles. However, the increased concentration of \textvar{A} particles will also cause more interactions between \textvar{A} particles and pairs of \textvar{B} particles, and so we will see an explosion in the number of predators. \autoref{fig:k=100000_f=1000000} has the parameters \textvar{f} = 1,000,000 and \textvar{k} = 100,000.\\

\begin{figure}[h]
\centering
\mySfFamily
\begin{tabular}{c c c c}
\includegraphics[width = 0.2\textwidth]{../images/predator_prey_f1e6_d1e5.png} & \includegraphics[width = 0.2\textwidth]{../images/../images/predator_prey_f1e6_d1e5_i1.png} & \includegraphics[width = 0.2\textwidth]{../images/../images/predator_prey_f1e6_d1e5_i2.png} & \includegraphics[width = 0.2\textwidth]{../images/../images/predator_prey_f1e6_d1e5_i3.png}\\[2ex]
\includegraphics[width = 0.2\textwidth]{../images/predator_prey_f1e6_d1e5_i4.png} & \includegraphics[width = 0.2\textwidth]{../images/../images/predator_prey_f1e6_d1e5_i5.png} & \includegraphics[width = 0.2\textwidth]{../images/../images/predator_prey_f1e6_d1e5_i6.png} & \includegraphics[width = 0.2\textwidth]{../images/../images/predator_prey_f1e6_d1e5_i7.png}
\end{tabular}
\caption{CAPTION NEEDED}
\label{fig:k=100000_f=1000000}
\end{figure}

The interesting behavior in this system lies in a sweet spot of the \textvar{f} and \textvar{k} parameters. For example, consider \autoref{fig:k=200000_f=100000}, which shows \textvar{f} is equal to 100,000 and \textvar{k} is equal to 200,000. We see a very clear stripe of predators expanding outward against a background of prey, with subsequent stripes appearing at locations where there is a critical mass of predators to interact with each other.\\

\begin{figure}[h]
\centering
\mySfFamily
\begin{tabular}{c c c c}
\includegraphics[width = 0.2\textwidth]{../images/predator_prey_11_by_11_f_1_k_2.png} & \includegraphics[width = 0.2\textwidth]{../images/../images/predator_prey_11_by_11_f_1_k_2_i1.png} & \includegraphics[width = 0.2\textwidth]{../images/../images/predator_prey_11_by_11_f_1_k_2_i2.png} & \includegraphics[width = 0.2\textwidth]{../images/../images/predator_prey_11_by_11_f_1_k_2_i3.png}\\[2ex]
\includegraphics[width = 0.2\textwidth]{../images/predator_prey_11_by_11_f_1_k_2_i4.png} & \includegraphics[width = 0.2\textwidth]{../images/../images/predator_prey_11_by_11_f_1_k_2_i5.png} & \includegraphics[width = 0.2\textwidth]{../images/../images/predator_prey_11_by_11_f_1_k_2_i6.png} & \includegraphics[width = 0.2\textwidth]{../images/../images/predator_prey_11_by_11_f_1_k_2_i7.png}
\end{tabular}
\caption{CAPTION NEEDED}
\label{fig:k=200000_f=100000}
\end{figure}

When we hold \textvar{k} fixed and increase \textvar{f} to 140,000, the higher feed rate increases the likelihood of \textvar{B} particles encountering \textvar{A} particles, and so we see even more stripes of \textvar{B} particles (\autoref{fig:k=200000_f=140000}).\\

\begin{figure}[h]
\centering
\mySfFamily
\begin{tabular}{c c c c}
\includegraphics[width = 0.2\textwidth]{../images/predator_prey_11_by_11_f_1.4_k_2.png} & \includegraphics[width = 0.2\textwidth]{../images/../images/predator_prey_11_by_11_f_1.4_k_2_i1.png} & \includegraphics[width = 0.2\textwidth]{../images/../images/predator_prey_11_by_11_f_1.4_k_2_i2.png} & \includegraphics[width = 0.2\textwidth]{../images/../images/predator_prey_11_by_11_f_1.4_k_2_i3.png}\\[2ex]
\includegraphics[width = 0.2\textwidth]{../images/predator_prey_11_by_11_f_1.4_k_2_i4.png} & \includegraphics[width = 0.2\textwidth]{../images/../images/predator_prey_11_by_11_f_1.4_k_2_i5.png} & \includegraphics[width = 0.2\textwidth]{../images/../images/predator_prey_11_by_11_f_1.4_k_2_i6.png} & \includegraphics[width = 0.2\textwidth]{../images/../images/predator_prey_11_by_11_f_1.4_k_2_i7.png}
\end{tabular}
\caption{CAPTION NEEDED}
\label{fig:k=200000_f=140000}
\end{figure}

As \textvar{f} approaches \textvar{k}, the stripe structure becomes chaotic and breaks down because there are now many clusters of \textvar{B} particles colliding and mix with each other. \autoref{fig:k=200000_f=175000} shows the result of raising \textvar{f} to 175,000.\\

\begin{figure}[h]
\centering
\mySfFamily
\begin{tabular}{c c c c}
\includegraphics[width = 0.2\textwidth]{../images/predator_prey_11_by_11_f_1.75_k_2_new.png} & \includegraphics[width = 0.2\textwidth]{../images/../images/predator_prey_11_by_11_f_1.75_k_2_new_i1.png} & \includegraphics[width = 0.2\textwidth]{../images/../images/predator_prey_11_by_11_f_1.75_k_2_new_i2.png} & \includegraphics[width = 0.2\textwidth]{../images/../images/predator_prey_11_by_11_f_1.75_k_2_new_i3.png}\\[2ex]
\includegraphics[width = 0.2\textwidth]{../images/predator_prey_11_by_11_f_1.75_k_2_new_i4.png} & \includegraphics[width = 0.2\textwidth]{../images/../images/predator_prey_11_by_11_f_1.75_k_2_new_i5.png} & \includegraphics[width = 0.2\textwidth]{../images/../images/predator_prey_11_by_11_f_1.75_k_2_new_i6.png} & \includegraphics[width = 0.2\textwidth]{../images/../images/predator_prey_11_by_11_f_1.75_k_2_new_i7.png}
\end{tabular}
\caption{CAPTION NEEDED}
\label{fig:k=200000_f=175000}
\end{figure}

Once \textvar{f} is equal to \textvar{k}, the stripes disappear (\autoref{fig:k=100000_f=100000}). We might expect this to mean that the \textvar{A} and \textvar{B} particles will be uniformly mixed. Instead, we see is that after an initial outward explosion of \textvar{B} particles, the system displays a mottled background, with pockets having higher or lower concentration of \textvar{B}. Our eye cannot help but see patterns of red and green clusters that resemble spots, or mottling.\\

\begin{figure}[h]
\centering
\mySfFamily
\begin{tabular}{c c c c}
\includegraphics[width = 0.2\textwidth]{../images/predator_prey_11_by_11_f_1_k_1.png} & \includegraphics[width = 0.2\textwidth]{../images/../images/predator_prey_11_by_11_f_1_k_1_i1.png} & \includegraphics[width = 0.2\textwidth]{../images/../images/predator_prey_11_by_11_f_1_k_1_i2.png} & \includegraphics[width = 0.2\textwidth]{../images/../images/predator_prey_11_by_11_f_1_k_1i3.png}\\[2ex]
\includegraphics[width = 0.2\textwidth]{../images/predator_prey_11_by_11_f_1_k_1_i4.png} & \includegraphics[width = 0.2\textwidth]{../images/../images/predator_prey_11_by_11_f_1_k_1_i5.png} & \includegraphics[width = 0.2\textwidth]{../images/../images/predator_prey_11_by_11_f_1_k_1_i6.png} & \includegraphics[width = 0.2\textwidth]{../images/../images/predator_prey_11_by_11_f_1_k_1_i7.png}
\end{tabular}
\caption{CAPTION NEEDED}
\label{fig:k=100000_f=100000}
\end{figure}

You may still be skeptical, since the patterns in the above videos do not have the concrete boundaries that we might expect of animal stripes and spots. Yet when we closely examine an animal with skin patterns, we can see that the patterns we infer on a higher level are just the net result of many individual, varied points.  \autoref{fig:zebrafish_zoom} illustrates this effect for zebrafish skin.\\

\begin{figure}[h]
\centering
\mySfFamily
\includegraphics[width = 0.6\textwidth]{../images/zebrafish_zoom.jpg}
\caption{Zooming in on the striped skin of a zebrafish shows that each stripe is formed of thousands of differently colored cells, and that the boundaries of the stripes are more variable than they may seem at lower resolution.}
\label{fig:zebrafish_zoom}
\end{figure}

\FloatBarrier
\phantomsection
\subsection{Turing's patterns and Klüver's hallucinations}

When you see the particle simulations in the previous section, an adjective that may have come to mind is ``trippy''. This is no accident.

Research dating all the way back to the 1920s has studied the patterns that we see during visual hallucinations, which Heinrich Klüver named \textdef{form constants}{form constants}{patterns seen during visual hallucinations, which recur across patients and were first studied by Heinrich Klüver in the 1920s} after studying patients who had taken mescaline. Form constants, such as cobwebs, tunnels, and spirals, occur across many individuals regardless of the cause of their hallucinations (\autoref{fig:form_constants}).\\

\begin{figure}[h]
\centering
\mySfFamily
\includegraphics[width = 0.6\textwidth]{../images/form_constants.png}
\caption{A few of Heinrich Klüver's form constants.}
\label{fig:form_constants}
\end{figure}

Over five decades after Klüver's work, researchers would determine that form constants having different shapes originate from simpler \textit{linear} stripes of cellular activation patterns in the retina. The retina is circular, but the brain needs to convert this cellular image into a rectangular field of view; as a result, when the linear patterns are passed to the visual cortex, the hallucinating brain contorts them into the spirals and whirls that we see. Some researchers believe that the patterns in the retina caused by hallucinations are in fact Turing patterns and can be explained by a reaction-diffusion model in which one type of neuron acts as a predator and another acts as prey.

\FloatBarrier
\phantomsection
\subsection{Streamlining our simulations}

Despite using advanced modeling and rendering software that has undergone years of development and optimization, each of the visualizations in this section took several hours to render. These simulations are computationally intensive because they require us to track the movement of tens of thousands of particles over thousands of generations.

We wonder if it is possible to build a model of Turing patterns that does not require so much computational overhead. In other words, is there a simplification that we can make to our model that will run faster but still produce Turing patterns? We will turn our attention to this question in the next section.\\

\FloatBarrier
\phantomsection

\section{The Gray-Scott Model: A Turing Pattern Cellular Automaton}
\label{sec:the_gray-scott_model:_a_turing_pattern_cellular_automaton}
\phantomsection

\subsection{A coarse-grained model of single particle diffusion}

Part of a modeler's job is to find simple models that capture the essence of a system while running quickly and scaling well to larger inputs.

In our case, we have a very ``fine-grained'' reaction-diffusion model illustrating Turing patterns, but this model consumes a huge amount of computational resources because it requires tracking the movements of hundreds of thousands of individual particles. Our goal is to build a model that will allow us to appreciate Turing patterns without significant computational overhead.

Our idea is to grid off two-dimensional space into blocks and store only the \textit{concentration} of each type of particle found inside the block. To make things even simpler, we assume that there is some maximum concentration of particles possible, so that we can divide the number of particles by this maximum concentration. As a result, the concentration of a particle in each block will be represented by a decimal number between 0 and 1.

Let us begin with an example of the diffusion of only \textvar{A} particles; we will later add \textvar{B} particles as well as reactions to our model. Say that the particles are at maximum concentration in the central cell of our grid and are present nowhere else, as shown in \autoref{fig:initial_A_concentration}.\\

\begin{figure}[h]
\centering
\mySfFamily
\includegraphics[width = 0.4\textwidth]{../images/initial_A_concentration.png}
\caption{A $\text{5} \times \text{5}$ grid showing hypothetical initial concentrations of \textvar{A} particles. Cells are labeled by numbers between 0 and 1 representing their concentration of \textvar{A} particles. The central cell has maximum concentration, and no particles are contained in any other cell.}
\label{fig:initial_A_concentration}
\end{figure}

We will now update the grid of cells after one time step to mimic particle diffusion. To do so, we will spread out the concentration of particles in each square to its eight neighbors. For example, we could assume that 20\% of the current cell's concentration diffuses to each of its four adjacent neighbors, and that 5\% of the cell's concentration diffuses to its four diagonal neighbors. Because the central square in our ongoing example is the only cell with any particles, the updated concentrations after a single time step are shown in \autoref{fig:A_concentration_one_time_step}.\\

\begin{figure}[h]
\centering
\mySfFamily
\includegraphics[width = 0.4\textwidth]{../images/A_concentration_one_time_step.png}
\caption{A grid showing an update to the system in \autoref{fig:initial_A_concentration} after diffusion of particles after a single time step.}
\label{fig:A_concentration_one_time_step}
\end{figure}

\begin{note}[%
The sum of the values in the grid in \autoref{fig:A_concentration_one_time_step} is 1, which is the same as the sum of the values in our original figure. Regardless of how many times we update the grid, the sum of the values should be 1 to ensure the conservation of total mass in the system.
]\end{note}

After an additional time step, the particles continue to diffuse outward. For example, each diagonal neighbor of the central cell in the above figure, which has a concentration of 0.05 after one time step, will lose all of its particles in the following step. Each of these cells will also gain 20\% of the particles from two of its adjacent neighbors, along with 5\% of the particles from the central square (which doesn't have any particles). This makes the updated concentration of this cell after two time steps equal to 2(0.2)(0.2) + 0.05(0) = 0.08.

The four cells directly adjacent to the central square, which have a concentration of 0.2 after one time step, will also gain particles from their neighbors. Each such cell will receive 20\% of the particles from two of its adjacent neighbors and 5\% of the particles from two of its diagonal neighbors, which have a concentration of 0.2. Therefore, the updated concentration of each of these cells after two time steps is 2(0.2)(0.05) + 2(0.05)(0.2) = 0.02 + 0.02 = 0.04.

Finally, the central square has no particles after one step, but it will receive 20\% of the particles from each of its four adjacent neighbors, as well as 5\% of the particles from each of its four diagonal neighbors. As a result, the central square's concentration after two time steps is 4(0.2)(0.2) + 4(0.05)(0.05) = 0.16 + 0.01 = 0.17.

In summary, the central nine squares after two time steps are as shown in \autoref{fig:A_concentration_two_time_steps_partial}.\\

\begin{figure}[h]
\centering
\mySfFamily
\includegraphics[width = 0.4\textwidth]{../images/A_concentration_two_time_steps_partial.png}
\caption{A grid showing an update to the central nine squares of the diffusion system in \autoref{fig:A_concentration_one_time_step} after an additional time step. The cells labeled ``?'' are left as an exercise for the reader.}
\label{fig:A_concentration_two_time_steps_partial}
\end{figure}

\begin{qbox}[%
What should the values of the ``?'' cells be in \autoref{fig:A_concentration_two_time_steps_partial}? Note that these cells are neighbors of cells with positive concentrations after one time step, so their concentrations should be positive after two time steps.
]\end{qbox}

The coarse-grained model of particle diffusion that we have built is a variant of a \textdef{cellular automaton}{cellular automaton}{a grid of cells in which we use fixed rules to update the status of a cell based on its current status and those of its neighbors}, or a grid of cells in which we use fixed rules to update the status of a cell based on its current status and those of its neighbors.\\

\begin{note}[%
Cellular automata form a rich area of research applied to a wide variety of fields dating back to the middle of the 20th Century; if you are interested in learning more about them from the perspective of programming, then you might like to check out the Programming for Lovers project (link).
]\end{note}

\FloatBarrier
\phantomsection
\subsection{Slowing down the rate of diffusion}

There is just one problem. Our cellular automaton model of diffusion is too volatile! 
Recall that \autoref{fig:initial_A_concentration}, \autoref{fig:A_concentration_one_time_step}, and
\autoref{fig:A_concentration_two_time_steps_partial} showed an initial automaton as well as its updates after each of two time steps. In a true diffusion process, all of the particles would not rush out of the central square in a single time step, only for some of them to return in the next step.

Our solution is to slow down the diffusion process by adding a parameter $d_A$ between 0 and 1 that represents the \textit{rate} of diffusion of \textvar{A} particles. Instead of moving a cell's entire concentration of particles to its neighbors in a single time step, we move only a fraction $d_A$ of them.

Revisiting our original example from \autoref{fig:initial_A_concentration}, say that $d_A$ is equal to 0.2. After the first time step, only 20\% of the central cell's particles will be spread to its neighbors. Of these particles, 5\% will be spread to diagonal neighbors, and 20\% will be spread to adjacent neighbors. \autoref{fig:A_concentration_slower_diffusion} illustrates that after one time step, the central square has concentration 0.8, its adjacent neighbors have concentration $0.2 \cdot d_A = 0.04$, and its diagonal neighbors have concentration $0.05 \cdot d_A = 0.01$.\\

\begin{figure}[h]
\centering
\mySfFamily
\includegraphics[width = 0.4\textwidth]{../images/A_concentration_slower_diffusion.png}
\caption{An updated grid of cells for the initial grid in \autoref{fig:initial_A_concentration} showing the concentration of \textvar{A} particles after one time step if $\textvar{d}_\textvar{A} = \text{0.2}$.}
\label{fig:A_concentration_slower_diffusion}
\end{figure}

\FloatBarrier
\phantomsection
\subsection{Adding a second particle to our diffusion simulation}

We now will add particle \textvar{B} to the simulation, which also starts with 100\% concentration in the central square. Recall that \textvar{B}, our ``predator'' molecule, diffuses half as fast as \textvar{A}, the ``prey'' molecule. If we set the diffusion rate $d_B$ equal to 0.1, then our cells after a time step will be updated as shown in \autoref{fig:two_particle_concentration_diffusion}, which represents the concentration of the two particles in each cell as an ordered pair $([\textvar{A}], [\textvar{B}])$.\\

\begin{figure}[h]
\centering
\mySfFamily
\includegraphics[width = 0.4\textwidth]{../images/two_particle_concentration_diffusion.png}
\caption{The cellular concentrations after one time step for two particles \textvar{A} and \textvar{B} that start at maximum concentration in the central square and diffuse at rates $\textvar{d}_\textvar{A} = \text{0.2}$ and $\textvar{d}_\textvar{B} = \text{0.1}$. Each cell is labeled by the ordered pair $([\textvar{A}], [\textvar{B}])$.}
\label{fig:two_particle_concentration_diffusion}
\end{figure}

\begin{qbox}[%
Update the cells in \autoref{fig:two_particle_concentration_diffusion} after another generation of diffusion. Use the diffusion rates $d_A = 0.2$ and $d_B = 0.1$.
]\end{qbox}

\FloatBarrier
\phantomsection
\subsection{Visualizing particle concentrations}

As we move toward diffusing a large board that is hundreds of cells wide, listing the concentrations of our two particles in each cell will be too much to process. Instead, we need some way to visualize the results of our diffusion simulation.

First, we will consolidate the information stored in a cell about the concentrations of two particles into a single value. In particular, let a cell's particle concentrations be denoted [\textvar{A}] and [\textvar{B}]. Then the single value $[\textvar{B}]/([\textvar{A}] + [\textvar{B}])$ is the ratio of the concentration of \textvar{B} particles to the total number of particles in the cell. This value ranges between 0 (no \textvar{B} particles present) and 1 (only \textvar{B} particles present).

Next, we color each cell in the grid according to its value of $[\textvar{B}]/([\textvar{A}] + [\textvar{B}])$ using a color spectrum like those shown in \autoref{fig:matplotlib_colormap}. We will use the `Spectral` color map, meaning that if a cell has a value close to 0 (relatively few predators), then it will be colored red, while if it has a value close to 1 (relatively many predators), then it will be colored dark blue.\\

\begin{figure}[h]
\centering
\mySfFamily
\includegraphics[width = 0.8\textwidth]{../images/matplotlib_colormap.png}
\caption{Phillip will fill in caption.}
\label{fig:matplotlib_colormap}
\end{figure}

When we color each cell over many time steps, we can animate the automaton to see how it changes over time. We are now ready for the following tutorial, in which we will implement and visualize our diffusion automaton using a \textdefnogloss{Jupyter notebook}.

\tutorial[https://biologicalmodeling.org/prologue/tutorial-diffusion]

\autoref{fig:diffusion_movie_still} shows an animation of a 101 x 101 board that begins with the following properties:
\begin{itemize}
\item $[\textvar{A}] = 1$ for all cells;
\item $[\textvar{B}] = 0$ for all cells other than an $11 \times 11$ square in the middle of the grid, where $[\textvar{B}] = 1$;
\item $d_A = 0.5$;
\item $d_A = 0.25$;
\end{itemize}

\begin{figure}[h]
\centering
\mySfFamily
\begin{tabular}{c c}
\includegraphics[width = 0.3\textwidth]{../images/diffusion__Moment_1.png} & \includegraphics[width = 0.3\textwidth]{../images/diffusion__Moment_2.png} \\[2ex]
\includegraphics[width = 0.3\textwidth]{../images/diffusion__Moment_3.png} & \includegraphics[width = 0.3\textwidth]{../images/diffusion__Moment_4.png}
\end{tabular}
\caption{Phillip will fill in caption.}
\label{fig:diffusion_movie_still}
\end{figure}

Note that the center of the cell becomes blue because the \textvar{A} particles diffuse twice as fast, so that they spread out more from the middle of the board, which is occupied in greater numbers by \textvar{B} particles.

\FloatBarrier
\phantomsection
\subsection{Adding reactions to our automaton: the Gray-Scott model}

Now that we have established a cellular automaton for coarse-grained particle diffusion, we will add to it the three reactions that we introduced in the previous section, which are reproduced below.

\begin{enumerate}
\item A ``feed'' reaction in which new \textvar{A} particles are fed into the system at a constant rate.
\item A ``death'' reaction in which \textvar{B} particles are removed from the system at a rate proportional to their current concentration.
\item A ``reproduction'' reaction $\textvar{A} + 2\textvar{B} \rightarrow 3\textvar{B}$.
\end{enumerate}

\begin{qbox}[%
How might we incorporate these reactions into our automaton?
]\end{qbox}

We will address these reactions one at a time. First, we have the feed reaction, which takes place at a rate \textvar{f}. It is tempting to simply add some constant value \textvar{f} to the concentration of each cell in each time step. However, if $[\textvar{A}]$ were close to 1, then adding \textvar{f} to it could cause $[\textvar{A}]$ to exceed 1, which we should avoid.

Instead, if a cell has current concentration $[\textvar{A}]$, then we will add $\textvar{f}(1-[\textvar{A}])$ to this cell's concentration of \textvar{A} particles. For example, if $[\textvar{A}]$ is 0.01, then we will add $0.99 \cdot \textvar{f}$ to the cell because the current concentration is low. If $[\textvar{A}]$ is 0.8, then we will only add $0.2 \cdot \textvar{f}$ to the concentration.

Second, we consider the death reaction of \textvar{B} particles, which takes place at rate \textvar{k}. Recall from the previous section that \textvar{k} is proportional to the current concentration of \textvar{B} particles. As a result, if a cell has concentration $[\textvar{B}]$, then for some constant \textvar{k} between 0 and 1, we will subtract $\textvar{k} \cdot [\textvar{B}]$ from the current concentration of \textvar{B} particles.

Third, we have the reproduction reaction $\textvar{A} + 2\textvar{B} \rightarrow 3\textvar{B}$, which takes place at a rate \textvar{r}. The higher the concentration of \textvar{A} and \textvar{B}, the more this reaction will take place. Furthermore, because we need \textit{two} \textvar{B} particles in order for the collision to occur, the reaction should be even more rare if we have a low concentration of \textvar{B} than if we have a low concentration of \textvar{A}. To model this situation, if a given cell is represented by the concentrations $([\textvar{A}], [\textvar{B}])$, then we will subtract $\textvar{r} \cdot [\textvar{A}] \cdot [\textvar{B}]^2$ from the concentration of \textvar{A} and add $\textvar{r} \cdot [\textvar{A}] \cdot [\textvar{B}]^2$ to the concentration of \textvar{B} in the next time step.

In summary, say that a cell has current concentrations $[\textvar{A}]$ and $[\textvar{B}]$. Say also that as the result of diffusion, the change in its concentrations are $\Delta A$ and $\Delta B$, where a negative number represents particles leaving the cell, and a positive number represents particles entering the cell. Then in the next time step, the particle concentrations $[\textvar{A}]_{\text{new}}$ and $[\textvar{B}]_{\text{new}}$ are given by the following equations.
\begin{align*}
[A]_{\text{new}} & = [A] + \Delta A + f \cdot (1-[A]) - r \cdot [A] \cdot [B]^2\\
[B]_{\text{new}} & = [B] + \Delta B - k \cdot [B] + r \cdot [A] \cdot [B]^2
\end{align*}

Applying these reaction-diffusion computations over all cells in parallel and over many generations forms a cellular automaton called the \textdef{Gray-Scott model}{Gray-Scott model}{a cellular automaton model generating Turing patterns without needing to track individual particles}.

Before continuing, let us consider an example of how a single cell might update its concentration of both particle types as a result of reaction and diffusion.  Say that we have the following hypothetical parameter values:

\begin{itemize}
\item $d_A = 0.2$;
\item $d_B = 0.1$;
\item $f = 0.3$;
\item $k = 0.4$;
\item $r = 1$ (the value typically always used in the Gray-Scott model).
\end{itemize}

Furthermore, say that our cell has the concentrations $([\textvar{A}], [\textvar{B}]) = (0.7, 0.5)$. Then as a result of diffusion, the cell's concentration of \textvar{A} will decrease by $0.7 \cdot d_A = 0.14$, and its concentration of \textvar{B} will decrease by $0.5 \cdot d_B = 0.05$. It will also receive particles from neighboring cells; for example, say that it receives an increase to its concentration of \textvar{A} by 0.08 and an increase to its concentration of \textvar{B} by 0.06 as the result of diffusion from neighbors. Therefore, $\Delta A  = 0.08 - 0.14 = -0.06$, and $\Delta B = 0.06 - 0.05 = 0.01$.

Now we will consider the three reactions. The feed reaction will cause the cell's concentration of \textvar{A} to increase by $(1 - [A]) \cdot f = 0.09$. The death reaction will cause its concentration of \textvar{B} to decrease by $k \cdot [B] = 0.2$. And the reproduction reaction will mean that the concentration of \textvar{A} decreases by $[A] \cdot [B]^2 = 0.175$, with the concentration of \textvar{B} increasing by the same amount.

As the result of all these processes, we update the concentrations of \textvar{A} and \textvar{B} to the following values $([A]_{\text{new}}, [B]_{\text{new}})$ in the next time step according to our equations above.
\begin{align*}
[A]_{\text{new}} & = 0.7 - 0.06 + 0.09 - 0.175 = 0.555\\
[B]_{\text{new}} & = 0.5 + 0.01 - 0.2 + 0.175 = 0.485
\end{align*}

We should now feel ready to implement the Gray-Scott model in the following tutorial. The question is: even though we have built a coarser-grained simulation than the previous section, will we still see Turing patterns?

\tutorial[https://biologicalmodeling.org/prologue/gs-jupyter]

\FloatBarrier
\phantomsection
\subsection{Reflection on the Gray-Scott model}

In contrast to our particle-based simulator, the Gray-Scott model produced an animation of Turing patterns in under a minute on a laptop. We show the results of this model in the videos that follow; throughout these animations, we use the parameters $d_A = 0.5$, $d_B = 0.25$, and $r = 1$.

\autoref{fig:gray-scott_movie_first_frame} shows an animation of the Gray-Scott model using the parameters  $f = 0.034$ and $k = 0.100$. We use the same initial configuration of the automaton that we used in the diffusion example, in which a cluster of \textvar{B} particles are found at the middle of a board full of \textvar{A} particles.\\

\begin{figure}[h]
\centering
\mySfFamily
\begin{tabular}{c c}
\includegraphics[width = 0.3\textwidth]{../images/gs_f038_k100_Moment_1.png} & \includegraphics[width = 0.3\textwidth]{../images/gs_f038_k100_Moment_2.png} \\[2ex]
\includegraphics[width = 0.3\textwidth]{../images/gs_f038_k100_Moment_3.png} & \includegraphics[width = 0.3\textwidth]{../images/gs_f038_k100_Moment_4.png}
\end{tabular}
\caption{Phillip will fill in caption.}
\label{fig:gray-scott_movie_first_frame}
\end{figure}

If we expand the size of the simulation and add multiple clusters of predators to the automaton, then the patterns become more complex as they intersect (\autoref{fig:gray-scott_multiple_predators_first_frame}).\\

\begin{figure}[h]
\centering
\mySfFamily
\begin{tabular}{c c}
\includegraphics[width = 0.3\textwidth]{../images/f038_100_multi_Moment_1.jpg} & \includegraphics[width = 0.3\textwidth]{../images/f038_100_multi_Moment_2.jpg} \\[2ex]
\includegraphics[width = 0.3\textwidth]{../images/f038_100_multi_Moment_3.jpg} & \includegraphics[width = 0.3\textwidth]{../images/f038_100_multi_Moment_4.jpg}
\end{tabular}
\caption{Phillip will fill in caption.}
\label{fig:gray-scott_multiple_predators_first_frame}
\end{figure}

If we keep the feed rate constant and increase the kill rate slightly to \textvar{k} = 0.102, then the patterns change significantly into spots (\autoref{fig:gray-scott_f38_k102_first_frame}).\\

\begin{figure}[h]
\centering
\mySfFamily
\begin{tabular}{c c}
\includegraphics[width = 0.3\textwidth]{../images/f038_102_multi_Moment_1.jpg} & \includegraphics[width = 0.3\textwidth]{../images/f038_102_multi_Moment_2.jpg} \\[2ex]
\includegraphics[width = 0.3\textwidth]{../images/f038_102_multi_Moment_3.jpg} & \includegraphics[width = 0.3\textwidth]{../images/f038_102_multi_Moment_4.jpg}
\end{tabular}
\caption{Phillip will fill in caption.}
\label{fig:gray-scott_f38_k102_first_frame}
\end{figure}

If we make the prey a little happier as well, increasing  \textvar{f} to 0.044 and keeping \textvar{k} at 0.102, then we have a different striped pattern (\autoref{fig:gray-scott_f44_k102_first_frame}).\\

\begin{figure}[h]
\centering
\mySfFamily
\begin{tabular}{c c}
\includegraphics[width = 0.3\textwidth]{../images/f044_102_multi_Moment_1.jpg} & \includegraphics[width = 0.3\textwidth]{../images/f044_102_multi_Moment_2.jpg} \\[2ex]
\includegraphics[width = 0.3\textwidth]{../images/f044_102_multi_Moment_3.jpg} & \includegraphics[width = 0.3\textwidth]{../images/f044_102_multi_Moment_4.jpg}
\end{tabular}
\caption{Phillip will fill in caption.}
\label{fig:gray-scott_f44_k102_first_frame}
\end{figure}

The point is that very slight changes in our model's parameters can produce drastically different results in terms of the patterns that we witness. In this chapter's conclusion, we will connect this observation back to our original motivation of identifying the cause for animal skin patterns.\\

\FloatBarrier
\phantomsection

\section{Conclusion: Turing Patterns are Fine-Tuned}
\label{sec:conclusion:_turing_patterns_are_fine-tuned}
\phantomsection

The Turing patterns that emerged from our particle simulations are a testament to the human eye's ability to find organization within the net behavior of tens of thousands of particles. For example, take another look at the results of the simulation in \autoref{fig:k=200000_f=200000}, which showed mottling in our particle simulator. Patterns are present, but they are also noisy --- even in the dark red regions we will have quite a few green particles, and vice-versa. The rapid inference of large-scale patterns from small-scale visual phenomena is one of the tasks that our brains have evolved to perform well.

Our reaction-diffusion system is remarkable because it is so \textdef{fine-tuned}{fine-tuned}{a property of a system in which small disturbances can lead to large changes in the system}, meaning that very slight changes in parameter values can lead to significant changes in the system. These changes could convert spots to stripes, or they could influence how clearly defined the boundaries of the Turing patterns are.

\autoref{fig:xmorphia-parameter-map} shows how the Turing patterns produced by the Gray-Scott model change as the kill and feed rates vary. The kill rate increases along the x-axis, and the feed rate increases along the y-axis. Notice how much the patterns change! You may like to tweak the parameters of the own Gray-Scott simulation from the previous section to see if you can reproduce these differing patterns.\\

\begin{figure}[h]
\centering
\mySfFamily
\includegraphics[width = 0.6\textwidth]{../images/xmorphia-parameter-map.jpg}
\caption{Changing kill (x-axis) and feed (y-axis) parameters greatly affects the Turing patterns produced in the Gray-Scott model. Note that many parameter choices do not lead to patterns.}
\label{fig:xmorphia-parameter-map}
\end{figure}

Later in this book, we will see an example of a biological system that is the opposite of fine-tuned. In a \textdef{robust}{robustness}{the ability of a system to retain a desired behavior despite perturbations such as changes to parameters} system, perturbations such as variations in parameters do not lead to substantive changes in the ultimate behavior of the system. Robustness is vital for processes, like your heartbeat, that must be resilient to small environmental changes.

It turns out that although Turing's work offers a compelling argument for how zebras might have gotten their stripes, the exact mechanism causing these stripes to form is still an unresolved question. However, the skin of \textit{zebrafish} does exhibit Turing patterns because two types of pigment cells follow a reaction-diffusion model much like the one we presented in this chapter. This chapter presented Turing particles as driven by the interactions of particles, but if the interactions occur between cells, then the resulting patterns are the same.

Finally, take a look at the following two photos of giant pufferfish in \autoref{fig:pufferfish}. These fish are genetically practically identical, but their skin patterns are very different. What may seem like a drastic change from spots to stripes is likely attributable to a small change of parameters in a fine-tuned biological system that, like much of life, is powered by randomness.\\

\begin{figure}[h]
\centering
\mySfFamily
\tabcolsep = 1em
\begin{tabular}{c c}
\includegraphics[width = 0.4\textwidth]{../images/Juvenile_Mbu_pufferfish.jpg} & \includegraphics[width = 0.4\textwidth]{../images/Giant_Puffer_fish_skin_pattern.jpg}
\end{tabular}
\caption{Two similar pufferfish with very different skin patterns. (Left) A juvenile Mbu pufferfish with a very familiar pattern. (Right) An adult Mbu pufferfish exhibiting another familiar pattern.}
\label{fig:pufferfish}
\end{figure}
